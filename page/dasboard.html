import express from "express"
import chalk from "chalk"
import fs from "fs"
import cors from "cors"
import path from "path"
import { fileURLToPath, pathToFileURL } from "url"
import { createRequire } from "module"
import dotenv from "dotenv"
import { startDiscordBot, updateStats } from "./src/discord.js"

const nodeVersion = process.versions.node.split(".")[0]
if (Number.parseInt(nodeVersion) < 20) {
  console.error("\x1b[31m%s\x1b[0m", "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
  console.error("\x1b[31m%s\x1b[0m", "â•‘                   ERROR: NODE.JS VERSION               â•‘")
  console.error("\x1b[31m%s\x1b[0m", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
  console.error("\x1b[31m%s\x1b[0m", `[ERROR] You are using Node.js v${process.versions.node}`)
  console.error("\x1b[31m%s\x1b[0m", "[ERROR] Asuma requires Node.js v20 or higher to run properly")
  console.error("\x1b[31m%s\x1b[0m", "[ERROR] Please update your Node.js installation and try again")
  console.error("\x1b[31m%s\x1b[0m", "[ERROR] Visit https://nodejs.org to download the latest version")
  console.error("\x1b[31m%s\x1b[0m", "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
  console.error("\x1b[31m%s\x1b[0m", "â•‘                  SHUTTING DOWN...                      â•‘")
  console.error("\x1b[31m%s\x1b[0m", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
  process.exit(1)
}

dotenv.config()

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)
const require = createRequire(import.meta.url)

const app = express()
let PORT = process.env.PORT || 3000

app.enable("trust proxy")
app.set("json spaces", 2)

app.use(express.json())
app.use(express.urlencoded({ extended: false }))
app.use(cors())

app.use((req, res, next) => {
  res.setHeader("X-Content-Type-Options", "nosniff")
  res.setHeader("X-Frame-Options", "DENY")
  res.setHeader("X-XSS-Protection", "1; mode=block")
  res.setHeader("Referrer-Policy", "strict-origin-when-cross-origin")
  next()
})

const requestCounts = new Map()
const RATE_LIMIT_WINDOW = 1 * 60 * 1000
const RATE_LIMIT_MAX = 50

app.use((req, res, next) => {
  try {
    const settings = JSON.parse(fs.readFileSync(path.join(__dirname, "./src/settings.json"), "utf-8"))
    
    const isApiEndpoint = req.path.startsWith('/api/') || 
                         req.path.startsWith('/ai/') || 
                         req.path.startsWith('/random/') || 
                         req.path.startsWith('/maker/')
    
    if (isApiEndpoint) {
      const endpoint = req.path.replace('/api/', '').replace('/ai/', 'ai/').replace('/random/', 'random/').replace('/maker/', 'maker/')
      updateStats(endpoint)
    }
    
    if (isApiEndpoint && settings.apiSettings && settings.apiSettings.requireApikey === false) {
      return next()
    }
  } catch (error) {
    console.error("Error loading settings for rate limiting:", error)
  }

  const ip = req.ip || req.connection.remoteAddress
  const now = Date.now()

  if (!requestCounts.has(ip)) {
    requestCounts.set(ip, { count: 1, resetTime: now + RATE_LIMIT_WINDOW })
  } else {
    const data = requestCounts.get(ip)
    if (now > data.resetTime) {
      data.count = 1
      data.resetTime = now + RATE_LIMIT_WINDOW
    } else {
      data.count++
      if (data.count > RATE_LIMIT_MAX) {
        return res.status(429).sendFile(path.join(__dirname, "page", "status", "4xx", "429.html"))
      }
    }
  }
  next()
})

setInterval(() => {
  const now = Date.now()
  for (const [ip, data] of requestCounts.entries()) {
    if (now > data.resetTime) {
      requestCounts.delete(ip)
    }
  }
}, RATE_LIMIT_WINDOW)

app.use((req, res, next) => {
  try {
    const settings = JSON.parse(fs.readFileSync(path.join(__dirname, "./src/settings.json"), "utf-8"))

    const skipPaths = ["/api/settings", "/assets/", "/src/", "/api/preview-image", "/src/sponsor.json", "/support"]
    const shouldSkip = skipPaths.some((path) => req.path.startsWith(path))

    if (settings.maintenance && settings.maintenance.enabled && !shouldSkip) {
      if (req.path.startsWith("/api/") || req.path.startsWith("/ai/")) {
        return res.status(503).json({
          status: false,
          error: "Service temporarily unavailable",
          message: "The API is currently under maintenance. Please try again later.",
          maintenance: true,
          creator: settings.apiSettings?.creator || "VGX Team",
        })
      }

      return res.status(503).sendFile(path.join(__dirname, "page", "status", "maintenance", "maintenance.html"))
    }

    next()
  } catch (error) {
    console.error("Error checking maintenance mode:", error)
    next()
  }
})

app.get("/assets/styles.css", (req, res) => {
  res.setHeader("Content-Type", "text/css")
  res.sendFile(path.join(__dirname, "page", "docs", "styles.css"))
})

app.get("/assets/script.js", (req, res) => {
  res.setHeader("Content-Type", "application/javascript")
  res.sendFile(path.join(__dirname, "page", "docs", "script.js"))
})

app.get("/page/sponsor.json", (req, res) => {
  try {
    const sponsorData = JSON.parse(fs.readFileSync(path.join(__dirname, "src", "sponsor.json"), "utf-8"))
    res.json(sponsorData)
  } catch (error) {
    res.status(500).json({ error: "Failed to load sponsor data" })
  }
})

app.get("/api/preview-image", (req, res) => {
  try {
    const previewImagePath = path.join(__dirname, "src", "images", "preview.png")

    if (fs.existsSync(previewImagePath)) {
      res.setHeader("Content-Type", "image/png")
      res.setHeader("Cache-Control", "public, max-age=86400")
      res.sendFile(previewImagePath)
    } else {
      const bannerPath = path.join(__dirname, "src", "images", "banner.jpg")
      if (fs.existsSync(bannerPath)) {
        res.setHeader("Content-Type", "image/jpeg")
        res.setHeader("Cache-Control", "public, max-age=86400")
        res.sendFile(bannerPath)
      } else {
        const iconPath = path.join(__dirname, "src", "images", "icon.png")
        res.setHeader("Content-Type", "image/png")
        res.setHeader("Cache-Control", "public, max-age=86400")
        res.sendFile(iconPath)
      }
    }
  } catch (error) {
    console.error("Error serving preview image:", error)
    res.status(404).json({ error: "Preview image not found" })
  }
})

app.get("/api/settings", (req, res) => {
  try {
    const settings = JSON.parse(fs.readFileSync(path.join(__dirname, "src", "settings.json"), "utf-8"))
    res.json(settings)
  } catch (error) {
    res.status(500).sendFile(path.join(__dirname, "page", "status", "5xx", "500.html"))
  }
})

app.get("/api/notifications", (req, res) => {
  try {
    const notifications = JSON.parse(fs.readFileSync(path.join(__dirname, "src", "notifications.json"), "utf-8"))
    res.json(notifications)
  } catch (error) {
    res.status(500).sendFile(path.join(__dirname, "page", "status", "5xx", "500.html"))
  }
})

app.get("/support", (req, res) => {
  res.sendFile(path.join(__dirname, "page", "support.html"))
})

app.use((req, res, next) => {
  const blockedPaths = [
    "/page/",
    "/src/settings.json",
    "/src/notifications.json",
    "/page/styles.css",
    "/page/script.js",
  ]

  const isBlocked = blockedPaths.some((blocked) => {
    if (blocked.endsWith("/")) {
      return req.path.startsWith(blocked)
    }
    return req.path === blocked
  })

  if (isBlocked) {
    return res.status(403).sendFile(path.join(__dirname, "page", "status", "4xx", "403.html"))
  }
  next()
})

app.use("/src/images", express.static(path.join(__dirname, "src", "images")))

app.use("/src", (req, res, next) => {
  if (req.path.match(/\.(jpg|jpeg|png|gif|svg|ico)$/i)) {
    express.static(path.join(__dirname, "src"))(req, res, next)
  } else {
    res.status(403).sendFile(path.join(__dirname, "page", "status", "4xx", "403.html"))
  }
})

const settingsPath = path.join(__dirname, "./src/settings.json")
const settings = JSON.parse(fs.readFileSync(settingsPath, "utf-8"))

app.use((req, res, next) => {
  const originalJson = res.json
  res.json = function (data) {
    if (data && typeof data === "object") {
      const responseData = {
        status: data.status ?? true,
        creator: settings.apiSettings.creator || "Asuma",
        ...data,
      }
      return originalJson.call(this, responseData)
    }
    return originalJson.call(this, data)
  }
  next()
})

let totalRoutes = 0
const apiFolder = path.join(__dirname, "./src/api")

const loadApiRoutes = async () => {
  const subfolders = fs.readdirSync(apiFolder)

  for (const subfolder of subfolders) {
    const subfolderPath = path.join(apiFolder, subfolder)
    if (fs.statSync(subfolderPath).isDirectory()) {
      const files = fs.readdirSync(subfolderPath)

      for (const file of files) {
        const filePath = path.join(subfolderPath, file)
        if (path.extname(file) === ".js") {
          try {
            const module = await import(pathToFileURL(filePath).href)
            const routeHandler = module.default
            if (typeof routeHandler === "function") {
              routeHandler(app)
              totalRoutes++
              console.log(
                chalk
                  .bgHex("#FFFF99")
                  .hex("#333")
                  .bold(` Loaded Route: ${path.basename(file)} `),
              )
            }
          } catch (error) {
            console.error(`Error loading route ${file}:`, error)
          }
        }
      }
    }
  }
}

await loadApiRoutes()

app.get("/", (req, res) => {
  res.sendFile(path.join(__dirname, "page", "index.html"))
})

app.get("/docs", (req, res) => {
  res.sendFile(path.join(__dirname, "page", "docs", "index.html"))
})

console.log(chalk.bgHex("#90EE90").hex("#333").bold(" Load Complete! "))
console.log(chalk.bgHex("#90EE90").hex("#333").bold(` Total Routes Loaded: ${totalRoutes} `))

app.use((err, req, res, next) => {
  console.error(err.stack)

  if (err.status === 400) {
    res.status(400).sendFile(path.join(__dirname, "page", "status", "4xx", "400.html"))
  } else if (err.status === 401) {
    res.status(401).sendFile(path.join(__dirname, "page", "status", "4xx", "401.html"))
  } else if (err.status === 402) {
    res.status(402).sendFile(path.join(__dirname, "page", "status", "4xx", "402.html"))
  } else if (err.status === 403) {
    res.status(403).sendFile(path.join(__dirname, "page", "status", "4xx", "403.html"))
  } else if (err.status === 405) {
    res.status(405).sendFile(path.join(__dirname, "page", "status", "4xx", "405.html"))
  } else if (err.status === 406) {
    res.status(406).sendFile(path.join(__dirname, "page", "status", "4xx", "406.html"))
  } else if (err.status === 407) {
    res.status(407).sendFile(path.join(__dirname, "page", "status", "4xx", "407.html"))
  } else if (err.status === 408) {
    res.status(408).sendFile(path.join(__dirname, "page", "status", "4xx", "408.html"))
  } else if (err.status === 409) {
    res.status(409).sendFile(path.join(__dirname, "page", "status", "4xx", "409.html"))
  } else if (err.status === 410) {
    res.status(410).sendFile(path.join(__dirname, "page", "status", "4xx", "410.html"))
  } else if (err.status === 411) {
    res.status(411).sendFile(path.join(__dirname, "page", "status", "4xx", "411.html"))
  } else if (err.status === 412) {
    res.status(412).sendFile(path.join(__dirname, "page", "status", "4xx", "412.html"))
  } else if (err.status === 413) {
    res.status(413).sendFile(path.join(__dirname, "page", "status", "4xx", "413.html"))
  } else if (err.status === 414) {
    res.status(414).sendFile(path.join(__dirname, "page", "status", "4xx", "414.html"))
  } else if (err.status === 415) {
    res.status(415).sendFile(path.join(__dirname, "page", "status", "4xx", "415.html"))
  } else if (err.status === 416) {
    res.status(416).sendFile(path.join(__dirname, "page", "status", "4xx", "416.html"))
  } else if (err.status === 417) {
    res.status(417).sendFile(path.join(__dirname, "page", "status", "4xx", "417.html"))
  } else if (err.status === 418) {
    res.status(418).sendFile(path.join(__dirname, "page", "status", "4xx", "418.html"))
  } else if (err.status === 421) {
    res.status(421).sendFile(path.join(__dirname, "page", "status", "4xx", "421.html"))
  } else if (err.status === 422) {
    res.status(422).sendFile(path.join(__dirname, "page", "status", "4xx", "422.html"))
  } else if (err.status === 423) {
    res.status(423).sendFile(path.join(__dirname, "page", "status", "4xx", "423.html"))
  } else if (err.status === 424) {
    res.status(424).sendFile(path.join(__dirname, "page", "status", "4xx", "424.html"))
  } else if (err.status === 425) {
    res.status(425).sendFile(path.join(__dirname, "page", "status", "4xx", "425.html"))
  } else if (err.status === 426) {
    res.status(426).sendFile(path.join(__dirname, "page", "status", "4xx", "426.html"))
  } else if (err.status === 428) {
    res.status(428).sendFile(path.join(__dirname, "page", "status", "4xx", "428.html"))
  } else if (err.status === 429) {
    res.status(429).sendFile(path.join(__dirname, "page", "status", "4xx", "429.html"))
  } else if (err.status === 431) {
    res.status(431).sendFile(path.join(__dirname, "page", "status", "4xx", "431.html"))
  } else if (err.status === 451) {
    res.status(451).sendFile(path.join(__dirname, "page", "status", "4xx", "451.html"))
  } else if (err.status === 501) {
    res.status(501).sendFile(path.join(__dirname, "page", "status", "5xx", "501.html"))
  } else if (err.status === 502) {
    res.status(502).sendFile(path.join(__dirname, "page", "status", "5xx", "502.html"))
  } else if (err.status === 503) {
    res.status(503).sendFile(path.join(__dirname, "page", "status", "5xx", "503.html"))
  } else if (err.status === 504) {
    res.status(504).sendFile(path.join(__dirname, "page", "status", "5xx", "504.html"))
  } else if (err.status === 505) {
    res.status(505).sendFile(path.join(__dirname, "page", "status", "5xx", "505.html"))
  } else if (err.status === 506) {
    res.status(506).sendFile(path.join(__dirname, "page", "status", "5xx", "506.html"))
  } else if (err.status === 507) {
    res.status(507).sendFile(path.join(__dirname, "page", "status", "5xx", "507.html"))
  } else if (err.status === 508) {
    res.status(508).sendFile(path.join(__dirname, "page", "status", "5xx", "508.html"))
  } else if (err.status === 510) {
    res.status(510).sendFile(path.join(__dirname, "page", "status", "5xx", "510.html"))
  } else if (err.status === 511) {
    res.status(511).sendFile(path.join(__dirname, "page", "status", "5xx", "511.html"))
  } else {
    res.status(500).sendFile(path.join(__dirname, "page", "status", "5xx", "500.html"))
  }
})

const findAvailablePort = (startPort) => {
  return new Promise((resolve) => {
    const server = app
      .listen(startPort, () => {
        const port = server.address().port
        server.close(() => resolve(port))
      })
      .on("error", () => {
        resolve(findAvailablePort(startPort + 1))
      })
  })
}

const startServer = async () => {
  try {
    PORT = await findAvailablePort(PORT)

    const server = app.listen(PORT, () => {
      console.log(chalk.bgHex("#90EE90").hex("#333").bold(` Server is running on port ${PORT} `))
    })

    process.on('SIGTERM', () => {
      console.log('SIGTERM received, shutting down gracefully')
      server.close(() => {
        console.log('Process terminated')
        process.exit(0)
      })
    })

    process.on('SIGINT', () => {
      console.log('SIGINT received, shutting down gracefully')
      server.close(() => {
        console.log('Process terminated')
        process.exit(0)
      })
    })

    startDiscordBot()
  } catch (err) {
    console.error(chalk.bgRed.white(` Server failed to start: ${err.message} `))
    process.exit(1)
  }
}

startServer()

export default app



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ API Live Dashboard - Asuma</title>
    <link rel="icon" href="/src/images/icon.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="/assets/dashboard.css">
    <script>
        let lastUpdate = Date.now();
        let websocket = null;
        let endpointMap = new Map();
        let tradingViewChart = null;
        
        window.addEventListener('beforeunload', () => {
            if (websocket) websocket.close();
        });
    </script>
</head>
<body>
    <div id="particles-js"></div>
    
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="header-left">
                <div class="logo">
                    <img src="/src/images/icon.png" alt="Logo">
                    <div>
                        <h1><span class="gradient-text">Asuma</span> <span class="version">v5</span></h1>
                        <p class="subtitle">API Monitoring Dashboard</p>
                    </div>
                </div>
                <div class="connection-status">
                    <span class="status-dot" id="connectionStatus"></span>
                    <span id="connectionText">Connecting...</span>
                </div>
            </div>
            
            <div class="header-center">
                <div class="server-clock">
                    <i class="fas fa-satellite"></i>
                    <span id="serverTime">--:--:-- UTC</span>
                </div>
                <div class="uptime">
                    <i class="fas fa-rocket"></i>
                    <span id="uptimeCounter">00:00:00</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="control-btn" id="themeToggle" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="control-btn" id="refreshBtn" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="control-btn" id="soundToggle" title="Sound On/Off">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button class="control-btn trading-btn" id="tradingToggle">
                    <i class="fas fa-chart-line"></i> Trading Mode
                </button>
                <div class="user-info">
                    <span class="creator-badge">DitssGanteng</span>
                </div>
            </div>
        </header>

        <div class="main-grid">
            <div class="card stat-card" data-card="requests">
                <div class="card-header">
                    <i class="fas fa-bolt"></i>
                    <h3>Total Requests</h3>
                    <span class="card-badge live">LIVE</span>
                </div>
                <div class="card-body">
                    <div class="stat-number" id="totalRequests">0</div>
                    <div class="stat-trend">
                        <span id="requestTrend" class="trend-up">â†— 0%</span>
                        <span class="stat-sub">Today</span>
                    </div>
                    <canvas class="mini-chart" id="requestsChart"></canvas>
                </div>
            </div>

            <div class="card stat-card" data-card="success">
                <div class="card-header">
                    <i class="fas fa-check-circle"></i>
                    <h3>Success Rate</h3>
                </div>
                <div class="card-body">
                    <div class="stat-number" id="successRate">100%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <div class="stat-detail">
                        <span>Successful: <span id="successCount">0</span></span>
                        <span>Failed: <span id="failedCount">0</span></span>
                    </div>
                </div>
            </div>

            <div class="card stat-card" data-card="response">
                <div class="card-header">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Avg Response</h3>
                </div>
                <div class="card-body">
                    <div class="stat-number" id="avgResponse">0ms</div>
                    <div class="response-gauge">
                        <div class="gauge" id="responseGauge"></div>
                    </div>
                    <div class="stat-sub">Fastest: <span id="fastestResponse">0ms</span></div>
                </div>
            </div>

            <div class="card stat-card" data-card="errors">
                <div class="card-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Error Rate</h3>
                </div>
                <div class="card-body">
                    <div class="stat-number error" id="errorRate">0%</div>
                    <div class="error-breakdown">
                        <div class="error-item">
                            <span class="error-dot" style="background: #ef4444"></span>
                            <span>4xx: <span id="error4xx">0</span></span>
                        </div>
                        <div class="error-item">
                            <span class="error-dot" style="background: #dc2626"></span>
                            <span>5xx: <span id="error5xx">0</span></span>
                        </div>
                    </div>
                    <button class="alert-btn" id="viewErrors">View Details</button>
                </div>
            </div>

            <div class="card wide-card" id="endpointMapCard">
                <div class="card-header">
                    <i class="fas fa-globe-americas"></i>
                    <h3>Global API Activity</h3>
                    <div class="map-controls">
                        <button class="map-btn" id="refreshMap"><i class="fas fa-sync-alt"></i></button>
                        <button class="map-btn" id="zoomIn"><i class="fas fa-search-plus"></i></button>
                        <button class="map-btn" id="zoomOut"><i class="fas fa-search-minus"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="worldMap"></div>
                    <div class="map-stats">
                        <div class="map-stat">
                            <i class="fas fa-users"></i>
                            <span>Active Users: <span id="activeUsers">0</span></span>
                        </div>
                        <div class="map-stat">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Locations: <span id="locationCount">0</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card wide-card" id="tradingViewCard">
                <div class="card-header">
                    <i class="fas fa-chart-line"></i>
                    <h3>API Trading View</h3>
                    <div class="trading-controls">
                        <select id="timeframe">
                            <option value="1h">1H</option>
                            <option value="4h">4H</option>
                            <option value="1d">1D</option>
                            <option value="1w">1W</option>
                        </select>
                        <button class="trading-action buy" id="simulateBuy">BUY</button>
                        <button class="trading-action sell" id="simulateSell">SELL</button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="tradingChart"></div>
                    <div class="trading-stats">
                        <div class="trading-stat">
                            <span class="label">API Volume</span>
                            <span class="value" id="apiVolume">0</span>
                        </div>
                        <div class="trading-stat">
                            <span class="label">Price</span>
                            <span class="value" id="apiPrice">$0.00</span>
                        </div>
                        <div class="trading-stat">
                            <span class="label">Change</span>
                            <span class="value positive" id="apiChange">+0.00%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" id="endpointsCard">
                <div class="card-header">
                    <i class="fas fa-network-wired"></i>
                    <h3>Live Endpoints</h3>
                    <span class="card-badge" id="endpointCount">0</span>
                </div>
                <div class="card-body">
                    <div class="endpoint-list" id="endpointList">
                        <div class="endpoint-item loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Loading endpoints...</span>
                        </div>
                    </div>
                    <div class="endpoint-search">
                        <input type="text" id="endpointSearch" placeholder="Search endpoint...">
                        <button id="clearSearch"><i class="fas fa-times"></i></button>
                    </div>
                </div>
            </div>

            <div class="card" id="liveStreamCard">
                <div class="card-header">
                    <i class="fas fa-stream"></i>
                    <h3>Real-time Stream</h3>
                    <div class="stream-controls">
                        <button class="stream-btn" id="pauseStream"><i class="fas fa-pause"></i></button>
                        <button class="stream-btn" id="clearStream"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="stream-container" id="liveStream">
                        <div class="stream-item system">
                            <span class="stream-time">00:00:00</span>
                            <span class="stream-message">Dashboard initialized. Connecting to API...</span>
                        </div>
                    </div>
                    <div class="stream-stats">
                        <span>Rate: <span id="requestRate">0</span>/sec</span>
                        <span>Total: <span id="streamTotal">0</span></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-panel">
            <div class="panel-section">
                <h4><i class="fas fa-cogs"></i> System Status</h4>
                <div class="system-grid">
                    <div class="system-item">
                        <i class="fas fa-database"></i>
                        <span>MongoDB: <span class="status-ok" id="dbStatus">Connected</span></span>
                    </div>
                    <div class="system-item">
                        <i class="fas fa-server"></i>
                        <span>Memory: <span id="memoryUsage">0 MB</span></span>
                    </div>
                    <div class="system-item">
                        <i class="fas fa-microchip"></i>
                        <span>CPU: <span id="cpuUsage">0%</span></span>
                    </div>
                    <div class="system-item">
                        <i class="fas fa-plug"></i>
                        <span>API Keys: <span id="apiKeyCount">0</span> Active</span>
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                <h4><i class="fas fa-history"></i> Recent Activity</h4>
                <div class="activity-timeline" id="activityTimeline">
                    <div class="timeline-item">
                        <div class="timeline-time">Just now</div>
                        <div class="timeline-content">Dashboard started successfully</div>
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                <h4><i class="fas fa-robot"></i> AI Insights</h4>
                <div class="insights" id="aiInsights">
                    <div class="insight-item">
                        <i class="fas fa-lightbulb"></i>
                        <span>All systems operational. No anomalies detected.</span>
                    </div>
                </div>
                <button class="insight-btn" id="generateInsight">
                    <i class="fas fa-magic"></i> Generate Report
                </button>
            </div>
        </div>

        <footer class="dashboard-footer">
            <div class="footer-left">
                <span>Â© 2024 Asuma â€¢ Made with <i class="fas fa-heart pulse"></i> by DitssGanteng</span>
            </div>
            <div class="footer-center">
                <span id="lastUpdate">Last update: --:--:--</span>
                <span class="separator">â€¢</span>
                <span id="apiVersion">API: v5</span>
            </div>
            <div class="footer-right">
                <button class="footer-btn" id="exportData">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="footer-btn" id="fullscreen">
                    <i class="fas fa-expand"></i> Fullscreen
                </button>
                <button class="footer-btn" id="helpBtn">
                    <i class="fas fa-question-circle"></i> Help
                </button>
            </div>
        </footer>
    </div>

    <div class="notification-center" id="notificationCenter"></div>

    <audio id="notificationSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" type="audio/mpeg">
    </audio>
    <audio id="tradingSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-casino-coin-toss-2994.mp3" type="audio/mpeg">
    </audio>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/assets/dashboard.js"></script>
</body>
</html>
